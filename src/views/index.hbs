<html>
<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css" integrity="sha384-zCbKRCUGaJDkqS1kPbPd7TveP5iyJE0EjAuZQTgFLD2ylzuqKfdKlfG/eSrtxUkn" crossorigin="anonymous">
    <script src="/socket.io/socket.io.js"></script>
     <script src="https://cdn.jsdelivr.net/npm/normalizr@3.6.1/dist/normalizr.browser.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>
<body>
  
  <div class="container mt-3">
    <div class="alert alert-success" style="display:flex; justify-content:space-between;" role="alert">
      <h1 style="max-width: 50%;">  bienvenido {{username}}!</h1>
      <form action="/logout" method="get" style="margin: 10px;">
    <button type="submit" class="btn btn-warning">Deslogear</button>
    </form> 
    <form action="/user" method="get" style="margin: 10px;">
    <button type="submit" class="btn btn-primary">Mi usuario</button>
    </form>
    <form action="/carrito/" method="get" style="margin: 10px;">
    <button type="submit" class="btn btn-light">Carrito</button>
    </form>  
  </div>
    <div class="jumbotron">
      <h1 style="color:blue">Ingrese Producto</h1>
      <br>
            <form onsubmit="addProd(this);return false">
              <div class="form-group">
               <label for="name"><b>Nombre</b></label> 
               <input id="nombre" class="form-control" type="text" name="nombre">
              </div>
              <div class="form-group">
                <label for="precio"><b>Precio</b></label> 
                <input id="precio" class="form-control" type="number" name="precio">
               </div>
               <div class="form-group">
                <label for="imageURL"><b>Foto URL</b></label> 
                <input id="fotoURL" class="form-control" type="text" name="fotoURL">
               </div>
                <div class="form-group">
                <label for="imageURL"><b>Codigo</b></label> 
                <input id="codigo" class="form-control" type="text" name="codigo">
               </div>
               <div class="form-group">
                <label for="imageURL"><b>Stock</b></label> 
                <input id="stock" class="form-control" type="text" name="stock">
               </div>
               <button class="btn btn-success mt-3 mb-5">Enviar</button>
            </form>
    
    </div>
  </div>
   <div class="container mt-3">
    <div class="jumbotron">
        <h2 style="color:crimson;">Productos</h2>
                {{#if contenido}}
            <div class="table-responsive">
                <table class="table table-dark">
                    <tr style="color: yellow"><th>Nombre</th><th>Precio</th><th>Imagen</th></tr>
                    {{#each contenido}}
                    <tr>
                        <td>{{this.nombre}}</td>
                        <td>${{this.precio}}</td>
                        <td><img src="{{this.fotoURL}}" style="max-height:30px"></td>
                        
                        <td style="width: 20%;"> 
                         
                        <button class="btn btn-success mt-3 mb-5" onclick="addToCart('{{this.id}}')">Agregar al carrito</button>
                       
                        </td>
                        
                        <td style="width: 10%;"> 
                          
                          <button class="btn btn-danger mt-3 mb-5" onclick="deleteProd('{{this.id}}')">X</button>
                
                          </td>
                    </tr>
                   {{/each}}
                </table>
            </div>
         {{else}}
                    <h3 class="alert alert-danger">no se encontraron datos </h3>
        {{/if}}
                    
    </div>
    <script>
const user = "{{ username }}"
axios.post(`http://localhost:8080/api/carrito/`,{})
.then((response) => {
        console.log(response)
    })
.catch((err) => {
        console.log(err)
    });
function deleteProd(id){
axios.delete(`http://localhost:8080/api/productos/${id}`)
.then((response) => {
    console.log(response)
})
.catch((err)=>{
    console.log(err)
})
}
function addProd(elem){

var nombre = document.getElementById('nombre').value
var precio = document.getElementById('precio').value
var fotoURL = document.getElementById('fotoURL').value
var codigo = document.getElementById('codigo').value
var stock = document.getElementById('stock').value

axios.post(`http://localhost:8080/api/productos/`,{
  nombre:nombre,
  precio:precio,
  fotoURL:fotoURL,
  codigo:codigo,
  stock:stock
})
.then((response) => {
    console.log(response)
})
.catch((err)=>{
    console.log(err)
})
}
function addToCart(id) {

axios.get(`http://localhost:8080/api/productos/${id}`)
.then((response) => {
        const elem = response.data[0]
        axios.post(`http://localhost:8080/api/carrito/${user}/productos`,{
  id:elem.id,
  nombre:elem.nombre,
  precio:elem.precio,
  fotoURL:elem.fotoURL,
  codigo:elem.codigo,
  stock:elem.stock
})
      .then((response) => {
        console.log(response)
    })
    })
.catch((err) => {
        console.log(err)
    });
}
</script>
    <script src="./main.js"></script>
</body>



</html>

